{% extends 'base.html' %}

{% block head %}
    <link rel="stylesheet" href="{{ url_for('static', filename='asistencias.css') }}">
{% endblock %}

{% block center %}
    {% for planilla in planillas %}
        <form action="" method="post">
            <table style="margin-bottom: 1rem;">
                <col width="50%"><col width="25%"><col width="25%">
                <thead>
                    <tr>
                        <th>
                            Planilla #{{ planilla.id }}
                        </th>
                        <th>
                            {% set evento = Evento.Get_Evento_By_ID(planilla.id_evento) %}
                            Evento: {{ evento.nombre }}
                        </th>
                        <th>
                            {{ planilla.fecha_creada }}
                        </th>
                    </tr>
                    <tr>
                        <th colspan="3">
                            Descripción: 
                            {% if planilla.descripcion != None %}
                                {{ planilla.descripcion }}
                            {% else %}
                                No tiene
                            {% endif %}
                        </th>
                    </tr>
                    <tr>
                        <th>
                            Bombero (Legajo)
                        </th>
                        <th>
                            Unidad
                        </th>
                        <th>
                            {% if evento.nombre != 'Conducta' %}
                                Asistencia
                            {% else %}
                                Conducta
                            {% endif %}

                        </th>
                    </tr>
                </thead>
                <tbody>
                    {% for detalle in planilla.detalles %}
                        <tr>
                            <td>
                                {{ Bombero.Get_Bombero_By_Legajo(detalle.legajo).apellido_nombre }} ({{ detalle.legajo }})
                            </td>
                            <td>
                                {% if detalle.id_unidad != None %}
                                    {{ Unidad.Get_Unidad_By_ID(detalle.id_unidad).nombre }} ({{Unidad.Get_Unidad_By_ID(detalle.id_unidad).patente}})
                                {% endif %}
                            </td>
                            <td>
                                {% if evento.nombre != 'Conducta' %}
                                    {% if detalle.estado == 1 %}
                                        Asistió
                                    {% elif detalle.estado == 2 %}
                                        Licencia
                                    {% else %}
                                        Ausente
                                    {% endif %}
                                {% else %}
                                    {% if detalle.estado == 1 %}
                                        Suficiente
                                    {% else %}
                                        Deficiente
                                    {% endif %}
                                {% endif %}

                            </td>
                        </tr>
                    {% endfor %}

                    <tr>
                        <td colspan="3">
                            <div class="botones">
                                <button type="submit" formaction="{{ url_for('asistencias.Aceptar_Planilla', id=planilla.id) }}">
                                    <span>Aceptar</span>
                                </button>
    
                                <button type="submit" formaction="{{ url_for('asistencias.Rechazar_Planilla', id=planilla.id) }}">
                                    <span>Rechazar</span>
                                </button>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </form>
    {% endfor %}
{% endblock %}